<html>
<head>
    <!--<script src="webjars/js-cookie/2.1.4/js.cookie.js"></script>-->
    <!--<script src="webjars/jquery/3.2.1/jquery.min.js"></script>-->
    <!--<script src="webjars/underscorejs/1.6.0/underscore.js"></script>-->
    <!--<script src="webjars/backbonejs/1.3.3/backbone.js"></script>-->
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
    <!--<script src="js/bootstrap.min.js"></script>-->
    <script src="js/phaser.js"></script>
</head>
<body id="body">
<script>
    let map;
    window.onload = function () {
        let fields;
        let walls;
        let hero;
        let stepButton;
        let stepCount;
        //  Note that this html file is set to pull down Phaser 2.5.0 from the JS Delivr CDN.
        //  Although it will work fine with this tutorial, it's almost certainly not the most current version.
        //  Be sure to replace it with an updated version before you start experimenting with adding your own code.
        map = {
            x: 13, y: 10, map:
                ['WWWWWWWWWWWWW',
                    'W  W     W  W',
                    'W  W     W  W',
                    'W  W     W  W',
                    'W           W',
                    'W           W',
                    'W  W     W  W',
                    'W  W     W  W',
                    'W  W     W  W',
                    'WWWWWWWWWWWWW'],
        };

        let game = new Phaser.Game('100%', '100%', Phaser.AUTO, document.body, {preload: preload, create: create, update: update});

        function preload() {
            game.load.image('logo', 'img/phaser.png');
            game.load.image('ground', 'img/ground.png');
            game.load.image('wall', 'img/wall.png');
            game.load.image('hero', 'img/hero.png');
        }

        function create() {
            game.stage.backgroundColor = "#a8aa33";
            fields = game.add.group();
            walls = game.add.group();
            stepCount = 0;

            let sprite;
            for (let i = 0; i < map.x; i++) {
                for (let j = 0; j < map.y; j++) {
                    if (map.map[j][i] === 'W') {
                        sprite = game.add.sprite(50 * i, 50 * j, 'wall');
                        sprite.posX = i;
                        sprite.posY = j;

                        walls.add(sprite);
                    } else {
                        sprite = game.add.sprite(50 * i, 50 * j, 'ground');
                        sprite.posX = i;
                        sprite.posY = j;

                        fields.add(sprite);
                    }
                }
            }
            hero = game.add.sprite(50 * 6 + 25, 50 * 5 + 25, 'hero');
            hero.anchor.x = 0.5;
            hero.anchor.y = 0.5;
            hero.posX = 6;
            hero.posY = 5;


            fields.setAll('inputEnabled', true);
            fields.callAll('events.onInputOver.add', 'events.onInputOver', function (event) {
                if ((Math.abs(event.posX - hero.posX) === 1 && (event.posY - hero.posY) === 0) ||
                    (Math.abs(event.posY - hero.posY) === 1 && (event.posX - hero.posX) === 0))
                    event.alpha = 0.65;
            });
            fields.callAll('events.onInputDown.add', 'events.onInputDown', function (event) {
                console.log(event);
                if ((Math.abs(event.posX - hero.posX) === 1 && (event.posY - hero.posY) === 0) ||
                    (Math.abs(event.posY - hero.posY) === 1 && (event.posX - hero.posX) === 0)) {
                    hero.posX = event.posX;
                    hero.posY = event.posY;
                    game.add.tween(hero).to({
                        x: event.x + 25, y: event.y + 25
                    }, 1000, 'Cubic', true);
                    event.alpha = 1;
                }
            });
            fields.callAll('events.onInputOver.add', 'events.onInputOut', function (event) {
                event.alpha = 1;

            });
            console.log(fields);

            stepButton = game.add.button(map.x * 50 + 10, 60, 'stepButton', addSteps, this);

        }

        function update() {
        }
        function addSteps() {
            console.log('pressed');
        }

        function canStepToField(x, y, hero, steps) {
            
        }

    };
</script>
</body>
</html>